(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{ImgP:function(t,e,a){"use strict";var s=a("uP05");a.n(s).a},QEyt:function(t,e,a){(t.exports=a("I1BE")(!1)).push([t.i,'.modal-right .modal-dialog[data-v-ff1a6b48],\n.modal-left .modal-dialog[data-v-ff1a6b48] {\n  min-width: 35%;\n}\n.modal-right .modal-dialog .modal-body[data-v-ff1a6b48],\n.modal-left .modal-dialog .modal-body[data-v-ff1a6b48] {\n  overflow-y: auto;\n}\n.section-loader[data-v-ff1a6b48] {\n  min-height: 90vh;\n  margin-left: 0;\n  position: fixed;\n}\n.form-group[data-v-ff1a6b48] {\n  position: relative;\n}\n.form-group span[data-v-ff1a6b48] {\n  position: absolute;\n  bottom: 7px;\n  right: 20px;\n  color: #d33;\n  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";\n  opacity: 0;\n  transition: ease-in 300ms opacity;\n  pointer-events: none;\n}\n.form-group.has-error .form-control[data-v-ff1a6b48] {\n  border-color: #f90a48;\n  box-shadow: 0 0 10px rgba(249, 10, 72, 0.2);\n}\n.form-group.has-error > span[data-v-ff1a6b48] {\n  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=100)";\n  opacity: 1;\n}',""])},qtF3:function(t,e,a){"use strict";a.r(e);var s=a("jbwR"),r=a("cZsb"),i=a("w02F"),n=a("NM1E");function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function d(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var l={name:"ManageDebitCards",data:function(){return{debitCards:[],debitCardTypes:[],debitCardDetails:{},sectionLoading:!1,details:{debit_card_type_id:null},userDetails:{}}},components:{PreLoader:a("YiU+").default},created:function(){this.getDebitCards()},mounted:function(){this.$emit("page-loaded")},methods:{slugToString:function(t){for(var e=t.split("_"),a=0;a<e.length;a++){var s=e[a];e[a]=s.charAt(0).toUpperCase()+s.slice(1)}return e.join(" ")},getDebitCards:function(){var t=this;BlockToast.fire({text:"loading debit cards..."}),axios.get(Object(s.pb)(this.saleRepId)).then((function(e){var a=e.data,s=a.debit_cards,r=a.debit_card_types;t.debitCards=s,t.debitCardTypes=r,t.$isDesktop?t.$nextTick((function(){$((function(){$("#datatable1").DataTable({responsive:!0,scrollX:!1,order:[[0,"desc"]],language:{searchPlaceholder:"Search...",sSearch:""}})}))})):t.$nextTick((function(){$((function(){$("#datatable1").DataTable({responsive:!1,scrollX:!0,order:[[0,"desc"]],language:{searchPlaceholder:"Search...",sSearch:""}})}))})),swal.close()}))},createDebitCard:function(){var t=this;this.$validator.validateAll().then((function(e){e?(BlockToast.fire({text:"creating debit card for user..."}),axios.post(r.c,function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){d(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}({},t.details)).then((function(e){var a=e.status;e.data.rsp;void 0!==a&&201==a&&(t.details={},t.userDetails={},Toast.fire({title:"Created",text:"It can now bw assigned to a sales rep's stock",icon:"success",position:"center"}))})).catch((function(t){500==t.response.status&&swal.fire({title:"Error",text:"Something went wrong on server. Creation not successful.",icon:"error"})}))):Toast.fire({title:"Invalid data! Try again",position:"center",icon:"error"})}))},assignCard:function(t){swal.fire({title:"Enter a Sales Rep's email",input:"text",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"Assign card",showLoaderOnConfirm:!0,preConfirm:function(e){return axios.put(Object(r.b)(t.id),{email:e}).then((function(t){if(204!==t.status)throw new Error(t.statusText);return{rsp:!0}})).catch((function(t){console.log(t.response),404===t.response.status?swal.showValidationMessage("Sales Rep details not found"):swal.showValidationMessage("Request failed: ".concat(t))}))},allowOutsideClick:function(){return!swal.isLoading()}}).then((function(t){t.value&&swal.fire({title:"Success",text:"Assigned to sales rep!",icon:"success"}).then((function(){location.reload()}))}))},allocateCard:function(t){swal.fire({title:"Enter a User's email",input:"email",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"Allocate card",showLoaderOnConfirm:!0,preConfirm:function(e){return axios.put(Object(n.c)(t.id),{email:e}).then((function(t){if(void 0===t)throw new Error("");if(204!==t.status)throw new Error(t.statusText);return{rsp:!0}})).catch((function(t){423===t.response.status?swal.showValidationMessage("Unassigned Card"):swal.showValidationMessage("Request failed: ".concat(t))}))},allowOutsideClick:function(){return!swal.isLoading()}}).then((function(t){t.value&&swal.fire({title:"Allocated",text:"The user will be required to activate the card before using it!",icon:"success"}).then((function(){location.reload()}))}))},deleteCard:function(t){var e=this;swalPreconfirm.fire({text:"This will delete this debit card and all its associated data.",preConfirm:function(){axios.delete(Object(s.Cb)(t.id),{permitted_routes:e.permitted_routes}).then((function(a){if(204===a.status){var s=e.debitCards.indexOf(t);-1!=s&&e.debitCards.splice(s,1),Toast.fire({title:"Success",text:"Card deleted",position:"center"})}else Toast.fire({title:"Failed",text:"Something wrong happend",position:"center"})}))}}).then((function(t){e.$nextTick((function(){$((function(){e.sectionLoading=!1}))}))}))},activateDebitCard:function(t){var e=this;this.sectionLoading=!0,axios.put(Object(i.a)(t.id),{permitted_routes:this.permitted_routes}).then((function(a){204===a.status?(t.is_admin_activated=!0,Toast.fire({title:"Success",text:"Card activated",position:"center"})):Toast.fire({title:"Failed",text:"Something wrong happend",position:"center"}),e.$nextTick((function(){$((function(){e.sectionLoading=!1}))}))}))},toggleDebitCardSuspension:function(t){var e=this;this.sectionLoading=!0,BlockToast.fire({text:"updating card status ..."}),axios.put(Object(s.Eb)(t.id),{permitted_routes:this.permitted_routes}).then((function(a){if(204===a.status){var s=t.is_suspended?"Card has been unsuspended":"Card has been suspended";t.is_suspended=!t.is_suspended,Toast.fire({title:"Success",text:s,position:"center"})}else Toast.fire({title:"Failed",text:"Something wrong happend",position:"center"});e.$nextTick((function(){$((function(){e.sectionLoading=!1}))}))}))},hasExpired:function(t){return new Date(t)<Date.now()},range:function(t,e){return _.range(t,e)}},computed:{saleRepId:function(){return this.$route.params.rep}}},c=(a("ImgP"),a("KHd+")),u=Object(c.a)(l,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("main",[a("page-header",{attrs:{pageTitle:"Manage Debit Cards"}}),t._v(" "),a("div",{staticClass:"content"},[a("div",{staticClass:"card"},[t.$user.isNormalAdmin?a("div",{staticClass:"card-title"},[a("button",{staticClass:"btn btn-bold btn-pure btn-twitter btn-shadow",attrs:{type:"button","data-toggle":"modal","data-target":"#modal-card"}},[t._v("Create Debit Card")])]):t._e(),t._v(" "),a("div",{staticClass:"card-body"},[a("table",{staticClass:"table table-bordered table-hover",attrs:{id:"datatable1"}},[t._m(0),t._v(" "),a("tbody",t._l(t.debitCards,(function(e){return a("tr",{key:e.id},[a("td",[t._v(t._s(e.id))]),t._v(" "),a("td",[t._v(t._s(e.card_user?e.card_user.email:"Unallocated"))]),t._v(" "),a("td",[t._v(t._s(e.sales_rep?e.sales_rep.email:e.is_user_activated?"Via Request":"Unassigned"))]),t._v(" "),a("td",[t._v(t._s(e.card_number))]),t._v(" "),a("td",[t._v(t._s(e.card_type))]),t._v(" "),a("td",[t._v(t._s(t._f("Naira")(e.amount)))]),t._v(" "),a("td",[t._v(t._s(t.hasExpired(e.exp_date)?"Expired":e.is_suspended?"Card Suspended":e.is_admin_activated?"Fully Activated":e.is_user_activated?"Pending Confirmation":"Not Activated"))]),t._v(" "),a("td",[!e.is_admin_activated&&e.is_user_activated&&t.$user.isCardAdmin?a("div",{staticClass:"fs-11 btn btn-bold badge badge-success badge-shadow pointer",on:{click:function(a){return t.activateDebitCard(e)}}},[t._v("Activate Card")]):t._e(),t._v(" "),e.is_admin_activated&&e.is_user_activated&&!e.is_suspended&&t.$user.isCardAdmin?a("div",{staticClass:"fs-11 btn btn-bold badge badge-primary pointer",on:{click:function(a){return t.toggleDebitCardSuspension(e)}}},[t._v("Suspend Card")]):t._e(),t._v(" "),e.is_suspended&&t.$user.isCardAdmin?a("div",{staticClass:"fs-11 btn btn-bold badge badge-purple pointer",on:{click:function(a){return t.toggleDebitCardSuspension(e)}}},[t._v("Unsuspend Card")]):t._e(),t._v(" "),!e.sales_rep&&t.$user.isNormalAdmin?a("div",{staticClass:"fs-11 btn btn-bold badge badge-purple pointer",on:{click:function(a){return t.assignCard(e)}}},[t._v("Assign Card")]):t._e(),t._v(" "),e.sales_rep&&!e.card_user&&t.$user.isSalesRep?a("div",{staticClass:"fs-11 btn btn-bold badge badge-success pointer",on:{click:function(a){return t.allocateCard(e)}}},[t._v("Allocate Card")]):t._e(),t._v(" "),!e.card_user&&t.$user.isAdmin?a("div",{staticClass:"fs-11 btn btn-bold badge badge-danger pointer",on:{click:function(a){return t.deleteCard(e)}}},[t._v("Delete Card")]):t._e()])])})),0)])]),t._v(" "),a("div",{staticClass:"modal modal-right fade",attrs:{id:"modal-card",tabindex:"-1"}},[a("div",{staticClass:"modal-dialog"},[a("div",{staticClass:"modal-content"},[t._m(1),t._v(" "),a("div",{staticClass:"modal-body"},[t.sectionLoading?a("pre-loader",{staticClass:"section-loader"}):t._e(),t._v(" "),a("div",{staticClass:"col-md-12"},[a("div",{staticClass:"card"},[t._m(2),t._v(" "),a("div",{staticClass:"card-body py-0"},[a("div",{staticClass:"card-row"},[a("form",{staticClass:"m-25",on:{submit:function(e){return e.preventDefault(),t.createDebitCard(e)}}},[a("div",{staticClass:"form-group mb-5",class:{"has-error":t.errors.has("card_number")}},[t._m(3),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.details.card_number,expression:"details.card_number"},{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"form-control form-control-pill",attrs:{type:"text",id:"form-full-name","data-vv-as":"credit card number",name:"card_number"},domProps:{value:t.details.card_number},on:{input:function(e){e.target.composing||t.$set(t.details,"card_number",e.target.value)}}}),t._v(" "),a("span",[t._v(t._s(t.errors.first("card_number")))])]),t._v(" "),a("div",{staticClass:"row"},[a("div",{staticClass:"col-4"},[a("div",{staticClass:"form-group mb-5",class:{"has-error":t.errors.has("exp_year")}},[t._m(4),t._v(" "),a("select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"},{name:"model",rawName:"v-model",value:t.details.year,expression:"details.year"}],staticClass:"form-control",attrs:{id:"form-year",name:"exp_year","data-vv-as":"expiry year"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.details,"year",e.target.multiple?a:a[0])}}},[a("option",{attrs:{value:""}},[t._v("Pick a Year")]),t._v(" "),t._l(t.range(2021,2099),(function(e){return a("option",{key:e},[t._v(t._s(e))])}))],2)])]),t._v(" "),a("div",{staticClass:"col-4"},[a("div",{staticClass:"form-group mb-5",class:{"has-error":t.errors.has("exp_month")}},[t._m(5),t._v(" "),a("select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"},{name:"model",rawName:"v-model",value:t.details.month,expression:"details.month"}],staticClass:"form-control",attrs:{id:"form-year",name:"exp_month","data-vv-as":"expiry month"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.details,"month",e.target.multiple?a:a[0])}}},[a("option",{attrs:{value:""}},[t._v("Pick a Month")]),t._v(" "),t._l(t.range(1,12),(function(e){return a("option",{key:e},[t._v(t._s(e))])}))],2)])]),t._v(" "),a("div",{staticClass:"col-4"},[a("div",{staticClass:"form-group mb-5",class:{"has-error":t.errors.has("csc")}},[t._m(6),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.details.csc,expression:"details.csc"},{name:"validate",rawName:"v-validate",value:"required|numeric",expression:"'required|numeric'"}],staticClass:"form-control form-control-pill",attrs:{type:"text",id:"form-full-name","data-vv-as":"card security code",name:"csc"},domProps:{value:t.details.csc},on:{input:function(e){e.target.composing||t.$set(t.details,"csc",e.target.value)}}})])]),t._v(" "),a("span",{staticClass:"text-danger"},[t._v(t._s(t.errors.first("csc")))]),t._v(" "),a("span",{staticClass:"text-danger"},[t._v(t._s(t.errors.first("exp_year")))]),t._v(" "),a("span",{staticClass:"text-danger"},[t._v(t._s(t.errors.first("exp_month")))])]),t._v(" "),a("div",{staticClass:"row"},[a("div",{staticClass:"col-12"},[a("div",{staticClass:"form-group mb-5",class:{"has-error":t.errors.has("debit_card_type")}},[t._m(7),t._v(" "),a("select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"},{name:"model",rawName:"v-model",value:t.details.debit_card_type_id,expression:"details.debit_card_type_id"}],staticClass:"form-control",attrs:{id:"form-year",name:"debit_card_type","data-vv-as":"debit card type"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.details,"debit_card_type_id",e.target.multiple?a:a[0])}}},[a("option",{domProps:{value:null}},[t._v("Card Type")]),t._v(" "),t._l(t.debitCardTypes,(function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.card_type_name))])}))],2)])]),t._v(" "),a("span",{staticClass:"text-danger"},[t._v(t._s(t.errors.first("debit_card_type")))])]),t._v(" "),t._m(8)])])])])])],1),t._v(" "),t._m(9)])])])])])],1)}),[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("thead",[a("tr",[a("th",[t._v("ID")]),t._v(" "),a("th",[t._v("Card User Email")]),t._v(" "),a("th",[t._v("Sales Rep")]),t._v(" "),a("th",[t._v("Number")]),t._v(" "),a("th",[t._v("Type")]),t._v(" "),a("th",[t._v("Amount")]),t._v(" "),a("th",[t._v("Status")]),t._v(" "),a("th",[t._v("Actions")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"modal-header"},[e("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal"}},[e("span",{attrs:{"aria-hidden":"true"}},[this._v("×")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"card-title flex j-c-between"},[e("h3",[this._v("Add New card")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("label",{attrs:{for:"form-full-name"}},[e("strong",[this._v("Card Number")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("label",{attrs:{for:"form-year"}},[e("strong",[this._v("Year")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("label",{attrs:{for:"form-year"}},[e("strong",[this._v("Month")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("label",{attrs:{for:"form-full-name"}},[e("strong",[this._v("CSC/CVV")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("label",{attrs:{for:"form-year"}},[e("strong",[this._v("Month")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"form-group mt-20"},[e("button",{staticClass:"btn btn-rss btn-round btn-block btn-bold",attrs:{type:"submit"}},[this._v("Create")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-bold btn-pure btn-secondary",attrs:{type:"button","data-dismiss":"modal"}},[this._v("Close")])])}],!1,null,"ff1a6b48",null);e.default=u.exports},uP05:function(t,e,a){var s=a("QEyt");"string"==typeof s&&(s=[[t.i,s,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};a("aET+")(s,r);s.locals&&(t.exports=s.locals)}}]);